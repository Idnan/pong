<!doctype html>
<html>
  <head>
		<title>Pong</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<style>
			#pong_canvas {border: 1px solid #333; margin: auto; }
		</style>
	</head>
	<body>
		<canvas id='pong_canvas' width='540' height='400'></canvas>
	
		<br><br><br>
		<button>Play</button>

		<script>			
			window.requestAnimFrame = (function(){
				return  window.requestAnimationFrame       	|| 
					window.webkitRequestAnimationFrame 		|| 
					window.mozRequestAnimationFrame    		|| 
					window.oRequestAnimationFrame      		|| 
					window.msRequestAnimationFrame     		||  
					function( callback ){
						return window.setTimeout(callback, 1000 / 60);
					};
			})();

			window.cancelRequestAnimFrame = ( function() {
				return window.cancelAnimationFrame          	||
					window.webkitCancelRequestAnimationFrame    ||
					window.mozCancelRequestAnimationFrame       ||
					window.oCancelRequestAnimationFrame     	||
					window.msCancelRequestAnimationFrame        ||
					clearTimeout
			} )();


			// Initialize canvas and required variables
			var canvas = document.getElementById("pong_canvas"),
					ctx = canvas.getContext("2d"), // Create canvas context
					W = 600, // Window's width
					H = 500, // Window's height
					particles = [], // Array containing particles
					ball = {}, // Ball object
					paddles = [2], // Array containing two paddles
					mouse = {}, // Mouse object to store it's current position
					points = 0, // Varialbe to store points
					paddleHit;

			// Add mousemove and mousedown events to the canvas
			canvas.addEventListener("mousemove", trackPosition, true);

			// Set the canvas's height and width to full screen
			canvas.width = W;
			canvas.height = H;

			// Function to paint canvas
			function paintCanvas() {
				ctx.fillStyle = "black";
				ctx.fillRect(0, 0, W, H);
			}

			// Function for creating paddles
			function Paddle(pos) {
				// Height and width
				this.h = 5;
				this.w = 150;
				
				// Paddle's position
				this.x = W/2 - this.w/2;
				this.y = (pos == "top") ? 0 : H - this.h;
				
			}

			// Push two new paddles into the paddles[] array
			paddles.push(new Paddle("bottom"));
			paddles.push(new Paddle("top"));

			// Ball object
			ball = {
				x: 50,
				y: 50, 
				r: 5,
				c: "white",
				vx: 4,
				vy: 8,
				
				// Function for drawing ball on canvas
				draw: function() {
					ctx.beginPath();
					ctx.fillStyle = this.c;
					ctx.arc(this.x, this.y, this.r, 0, Math.PI*2, false);
					ctx.fill();
				}
			};

			// Draw everything on canvas
			function draw() {
				paintCanvas();
				for(var i = 0; i < paddles.length; i++) {
					p = paddles[i];
					
					ctx.fillStyle = "white";
					ctx.fillRect(p.x, p.y, p.w, p.h);
				}
				
				ball.draw();
				update();
			}

			// Track the position of mouse cursor
			function trackPosition(e) {
				mouse.x = e.pageX;
				mouse.y = e.pageY;
			}

			// Function to update positions, score and everything.
			function update() {
				
				// Update scores
				updateScore(); 
				
				// Move the paddles on mouse move
				if(mouse.x && mouse.y) {
					for(var i = 1; i < paddles.length; i++) {
						p = paddles[i];
						p.x = mouse.x - p.w/2;
					}		
				}
				
				// Move the ball
				ball.x += ball.vx;
				ball.y += ball.vy;
				
				// Collision with paddles
				p1 = paddles[1];
				p2 = paddles[2];
				
				// If the ball strikes with paddles
				if(collides(ball, p1)) {
					collideAction(ball, p1);
				}
				
				
				else if(collides(ball, p2)) {
					collideAction(ball, p2);
				} 
				
				else {
					// Collide with walls, If the ball hits the top/bottom,					
					if(ball.y + ball.r > H) {
						ball.y = H - ball.r;
						alert('gameOver');
						window.location.reload();
					} 
					
					else if(ball.y < 0) {
						ball.y = ball.r;
						alert('gameOver');
						window.location.reload();
					}
					
					// If ball strikes the vertical walls, invert the 
					// x-velocity vector of ball
					if(ball.x + ball.r > W) {
						ball.vx = -ball.vx;
						ball.x = W - ball.r;
					}
					
					else if(ball.x -ball.r < 0) {
						ball.vx = -ball.vx;
						ball.x = ball.r;
					}
				}
			}

			//Function to check collision between ball and one of
			//the paddles
			function collides(b, p) {
				if(b.x + ball.r >= p.x && b.x - ball.r <=p.x + p.w) {
					if(b.y >= (p.y - p.h) && p.y > 0){
						paddleHit = 1;
						return true;
					}
					
					else if(b.y <= p.h && p.y == 0) {
						paddleHit = 2;
						return true;
					}
					
					else return false;
				}
			}

			//Do this when collides == true
			function collideAction(ball, p) {
				ball.vy = -ball.vy;
				
				if(paddleHit == 1) {
					ball.y = p.y - p.h;
				}
				
				else if(paddleHit == 2) {
					ball.y = p.h + ball.r;
				}
				
				points++;
			}

			// Function for updating score
			function updateScore() {
				ctx.fillStlye = "white";
				ctx.font = "16px Arial, sans-serif";
				ctx.textAlign = "left";
				ctx.textBaseline = "top";
				ctx.fillText("Score: " + points, 20, 20 );
			}

			function animloop() {
				requestAnimFrame(animloop);
				draw();
			}

			$('button').on('click', function() {
				animloop();
			});
		</script>
	</body>
</html>